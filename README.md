# 高级定时闹钟 (AdvancedClock)

<p align="center">
  <img src="assets/icon.svg" alt="AdvancedClock Icon" width="128" height="128">
</p>

一个功能强大的 WPF 定时闹钟应用程序，支持多种循环模式、数据持久化和开机自动启动。

## ✨ 主要功能

### 1. 多种循环模式
- **不循环（一次性）**：闹钟触发一次后自动禁用
- **按天循环**：每天在设定的时间触发
- **按月循环**：每月在设定的日期和时间触发
- **按年循环**：每年在设定的月份、日期和时间触发

### 2. 数据持久化 🆕
- **自动保存**：闹钟数据自动保存到用户目录
- **数据位置**：`%AppData%\AdvancedClock\alarms.json`
- **实时保存**：添加、编辑、删除或修改闹钟时自动保存
- **自动加载**：程序启动时自动加载上次保存的闹钟数据
- **JSON格式**：使用易读的JSON格式存储数据

### 3. 开机自动启动 🆕
- **一键设置**：通过界面复选框轻松启用/禁用开机启动
- **注册表管理**：自动管理Windows启动项
- **状态同步**：启动时自动检测并显示当前开机启动状态

### 4. 自定义闹钟声音 🆕
- **多格式支持**：支持 WAV, MP3, WMA, M4A 等音频格式
- **个性化设置**：每个闹钟可以设置不同的提醒声音
- **默认声音库**：自动枚举 sounds/defaults 目录下的声音文件
- **下拉选择**：快速从预设声音库中选择，无需浏览文件系统
- **自定义文件**：支持选择任意位置的音频文件
- **循环播放**：声音自动循环播放，可设置播放时长（5-600秒）
- **智能停止**：到达设定时长后自动停止播放
- **试听功能**：创建闹钟时可以预览声音效果（5秒试听）
- **系统默认**：不选择文件时使用 Windows 系统默认声音
- **详细说明**：[声音增强功能指南](docs/SOUND_ENHANCEMENT_GUIDE.md)
- **声音资源**：[默认声音获取指南](sounds/DEFAULT_SOUNDS_GUIDE.md)

### 5. 强提醒与弱提醒
- **强提醒（全屏遮罩）**：闹钟触发时全屏灰色遮罩，必须点击关闭按钮才能继续操作
- **弱提醒（任务栏通知）**：闹钟触发时在任务栏显示气泡通知，不影响正常操作
- **灵活选择**：每个闹钟可独立设置提醒方式
- **视觉效果**：强提醒窗口带有精美的动画和图标

### 6. 系统托盘支持 🆕
- **最小化到托盘**：关闭窗口时可选择隐藏而非退出
- **后台运行**：程序在托盘中持续运行，闹钟服务不中断
- **快速访问**：双击托盘图标恢复窗口
- **右键菜单**：托盘图标右键菜单提供快速操作
- **气泡提示**：最小化时显示提示信息

**详细说明**：[系统托盘使用指南](docs/TRAY_GUIDE.md)

### 7. 用户友好界面
- **实时时钟**：显示当前日期和时间
- **闹钟列表**：清晰展示所有闹钟信息
- **快速操作**：添加、编辑、删除、测试闹钟
- **启用/禁用**：单击复选框即可启用或禁用闹钟
- **数据管理**：一键打开数据文件所在目录

## 🚀 使用方法

### 基本操作

1. **添加闹钟**
   - 点击"添加闹钟"按钮
   - 填写闹钟名称、时间、循环模式和消息
   - 选择是否启用"强提醒（全屏遮罩）"
   - 点击"确定"保存

2. **编辑闹钟**
   - 在列表中选择要编辑的闹钟
   - 点击"编辑闹钟"按钮
   - 修改信息后点击"确定"

3. **删除闹钟**
   - 在列表中选择要删除的闹钟
   - 点击"删除闹钟"按钮
   - 确认删除操作

4. **测试闹钟**
   - 在列表中选择要测试的闹钟
   - 点击"测试闹钟"按钮
   - 立即触发闹钟提醒

### 数据管理 🆕

1. **查看数据文件**
   - 点击"📁 查看数据文件"按钮
   - 自动打开数据文件所在目录
   - 数据文件：`alarms.json`

2. **数据备份**
   - 复制 `%AppData%\AdvancedClock\alarms.json` 文件
   - 保存到安全位置

3. **数据恢复**
   - 关闭程序
   - 将备份的 `alarms.json` 文件复制回原位置
   - 重新启动程序

### 开机启动设置 🆕

1. **启用开机启动**
   - 勾选界面底部的"开机自动启动"复选框
   - 程序会自动添加到Windows启动项

2. **禁用开机启动**
   - 取消勾选"开机自动启动"复选框
   - 程序会自动从Windows启动项中移除

### 系统托盘设置 🆕

1. **启用托盘功能**
   - 勾选界面底部的"关闭时最小化到托盘"复选框
   - 点击关闭按钮时，程序会隐藏到系统托盘而不是退出

2. **从托盘恢复窗口**
   - 双击系统托盘中的程序图标
   - 或右键图标选择"显示主窗口"

3. **真正退出程序**
   - 右键系统托盘图标
   - 选择"退出程序"

**详细说明**：[系统托盘使用指南](docs/TRAY_GUIDE.md)

## 📁 数据存储

### 存储位置
```
%AppData%\AdvancedClock\alarms.json
```

实际路径示例：
```
C:\Users\YourUsername\AppData\Roaming\AdvancedClock\alarms.json
```

### 数据格式
```json
[
  {
    "Id": "guid",
    "Name": "闹钟名称",
    "AlarmTime": "2025-12-03T08:00:00",
    "RepeatMode": "Daily",
    "IsEnabled": true,
    "Message": "闹钟消息",
    "IsStrongAlert": false
  }
]
```

## 📁 项目结构

项目采用清晰的目录结构组织：

```
AdvancedClock/
├── assets/          # 图片和资源文件
├── docs/            # 项目文档
├── .github/         # GitHub 配置
└── *.cs, *.xaml     # 源代码文件
```

**详细说明**：[项目结构文档](PROJECT_STRUCTURE.md)

## 🔧 技术特性

- **框架**：.NET 7.0 + WPF
- **架构**：MVVM模式
- **数据绑定**：ObservableCollection + INotifyPropertyChanged
- **序列化**：System.Text.Json
- **定时器**：DispatcherTimer（每秒检查）
- **注册表**：Microsoft.Win32.Registry
- **CI/CD**：GitHub Actions 自动化构建

## 🔨 开发与构建

### 项目结构

```
AdvancedClock/
├── src/                          # 源代码目录
│   ├── *.cs                      # C# 源代码文件
│   ├── *.xaml                    # WPF 界面文件
│   └── *.xaml.cs                 # WPF 代码后置文件
├── docs/                         # 文档目录
├── assets/                       # 资源文件目录
├── scripts/                      # 脚本文件目录
├── .github/                      # GitHub 配置目录
├── .vscode/                      # VS Code 配置目录
├── AdvancedClock.csproj          # 项目文件
├── AdvancedClock.sln             # 解决方案文件
└── README.md                     # 项目说明文件
```

详细的项目结构说明请参考：[docs/PROJECT_STRUCTURE_NEW.md](docs/PROJECT_STRUCTURE_NEW.md)

### 本地开发

**前置要求**：
- .NET 7.0 SDK
- Visual Studio 2022 或 Rider
- VS Code（推荐，已配置完整调试环境）🆕

**构建命令**：
```powershell
# 恢复依赖
dotnet restore AdvancedClock.sln

# 构建项目
dotnet build AdvancedClock.sln --configuration Release

# 发布应用
dotnet publish AdvancedClock.csproj --configuration Release --output ./publish
```

### VS Code 调试环境 🆕

项目已完整配置 VS Code 调试环境：

- ✅ **多种调试配置**：Debug、Release、附加进程、断点调试等
- ✅ **自动化任务**：构建、发布、清理、监视等
- ✅ **扩展推荐**：自动推荐必需的 C# 和 .NET 扩展
- ✅ **代码格式化**：EditorConfig 统一代码风格
- ✅ **智能提示**：完整的 IntelliSense 支持

**快速开始**：
1. 在 VS Code 中打开项目文件夹
2. 安装推荐的扩展
3. 按 `F5` 开始调试

**调试配置**：
- **启动 AdvancedClock (Debug)** - 默认调试配置
- **启动 AdvancedClock (Release)** - 性能测试配置
- **附加到 AdvancedClock 进程** - 附加到运行中的进程
- **启动 AdvancedClock (断点调试)** - 深度调试配置

**详细说明**：[VS Code 调试指南](docs/VSCODE_DEBUG_GUIDE.md) 🆕

### GitHub Actions 自动化

本项目已配置 GitHub Actions 自动化工作流：

- ✅ **自动构建**：推送代码时自动编译
- ✅ **多配置支持**：同时构建 Debug 和 Release 版本
- ✅ **产物上传**：构建完成后自动上传可执行文件
- ✅ **自动发布**：推送版本标签时自动创建 GitHub Release 🆕
- ✅ **多分支支持**：支持 main 和 master 分支
- ✅ **环境变量管理**：所有配置项集中在 `env` 中，易于维护

**配置文件位置**：`.github/workflows/dotnet-desktop.yml`

**环境变量配置**：
```yaml
env:
  PROJECT_NAME: AdvancedClock              # 项目名称
  SOLUTION_FILE: AdvancedClock.sln         # 解决方案文件
  PROJECT_FILE: AdvancedClock.csproj       # 项目文件
  DOTNET_VERSION: 7.0.x                    # .NET 版本
  PUBLISH_OUTPUT_DIR: ./publish            # 输出目录
  ARTIFACT_RETENTION_DAYS: 30              # 保留天数
```

### 🚀 自动发布到 Release 🆕

**快速发布**：
```powershell
# 使用自动化脚本创建发布
.\scripts\create-release.ps1 -Version "v1.0.0" -Message "版本 1.0.0 正式发布"
```

**手动发布**：
```bash
# 创建版本标签
git tag -a v1.0.0 -m "版本 1.0.0 发布"
git push origin v1.0.0
```

**自动化流程**：
1. 推送版本标签（如 `v1.0.0`）
2. GitHub Actions 自动构建 Release 版本
3. 自动打包为 ZIP 文件
4. 自动创建 GitHub Release
5. 自动上传安装包到 Release 页面
6. 自动生成更新日志

**查看构建状态**：访问仓库的 Actions 标签页

**下载构建产物**：在 Actions 页面的成功构建记录中下载

详细信息请参阅：
- [GitHub Actions 使用指南](docs/GITHUB_ACTIONS_GUIDE.md)
- [自动发布指南](docs/RELEASE_GUIDE.md) 🆕
- [VS Code 调试指南](docs/VSCODE_DEBUG_GUIDE.md) 🆕

## 📝 注意事项

1. **权限要求**
   - 开机启动功能需要修改注册表权限
   - 通常情况下用户权限即可，无需管理员权限

2. **数据安全**
   - 数据文件存储在用户目录，不会丢失
   - 建议定期备份重要的闹钟数据

3. **时间精度**
   - 闹钟检查精度为1秒
   - 触发时间误差在1秒以内

4. **循环闹钟** 🆕
   - 循环闹钟**永不过期**，自动更新到下一个有效时间
   - 创建/编辑时，如果时间已过，自动调整到下一次
   - 程序启动时，自动修复过期的循环闹钟
   - 触发后自动计算下次触发时间
   - 一次性闹钟触发后自动禁用

## 🎯 示例场景

### 场景1：每日工作提醒
- **名称**：工作开始提醒
- **时间**：每天 09:00:00
- **循环**：每天
- **消息**：开始新的一天工作！

### 场景2：月度账单提醒
- **名称**：信用卡还款
- **时间**：每月 25日 10:00:00
- **循环**：每月
- **消息**：记得还信用卡！

### 场景3：年度纪念日
- **名称**：结婚纪念日
- **时间**：每年 6月15日 09:00:00
- **循环**：每年
- **消息**：今天是结婚纪念日！

### 场景4：临时提醒
- **名称**：会议提醒
- **时间**：2025-12-03 14:30:00
- **循环**：不循环
- **消息**：30分钟后有重要会议！

### 场景5：重要事项强提醒 🆕
- **名称**：重要会议
- **时间**：2025-12-03 15:00:00
- **循环**：不循环
- **强提醒**：✅ 启用（全屏遮罩）
- **消息**：重要客户会议即将开始！
- **说明**：使用强提醒确保不会错过重要会议

### 场景6：日常事项弱提醒 🆕
- **名称**：喝水提醒
- **时间**：每天 10:00:00
- **循环**：每天
- **强提醒**：❌ 不启用（任务栏通知）
- **消息**：该喝水了，保持健康！
- **说明**：使用弱提醒不打断当前工作

## 🔄 更新日志

### v2.5.2 (2025-12-20) 🐛
- 🐛 修复声音文件不显示的问题
- ✅ 在项目文件中添加配置，将 sounds 目录复制到输出目录
- ✅ 现在下拉列表可以正确显示所有默认声音文件
- 📚 创建详细的修复说明文档

### v2.5.1 (2025-12-20) 🐛
- 🐛 修复编辑对话框打开时的空引用异常（NullReferenceException）
- ✅ 为 SoundSourceChanged 方法添加空值检查
- ✅ 为 InitializeSoundSelection 方法添加空值检查
- ✅ 为 LoadDefaultSounds 方法添加空值检查
- ✅ 为 DefaultSoundComboBox_SelectionChanged 方法添加空值检查
- ✅ 提高代码健壮性，防止控件未初始化时访问
- 📚 创建详细的修复说明文档

### v2.5 (2025-12-19) 🆕
- ✅ 新增默认声音库支持，自动枚举 sounds/defaults 目录
- ✅ 添加声音下拉选择框，快速选择预设声音
- ✅ 支持双模式选择：默认声音库 + 自定义文件
- ✅ 实现循环播放功能，声音自动重复播放
- ✅ 添加播放时长控制（5-600秒，默认60秒）
- ✅ 智能停止机制，到达时长自动停止播放
- ✅ 优化试听功能，固定5秒预览
- ✅ 更新音频服务，支持循环播放和定时停止
- ✅ 完善UI界面，添加播放时长设置

### v2.4 (2025-12-19)
- ✅ 新增自定义闹钟声音功能
- ✅ 支持 WAV, MP3, WMA, M4A 等音频格式
- ✅ 每个闹钟可以设置不同的提醒声音
- ✅ 添加声音试听功能
- ✅ 创建 AudioService 音频播放服务
- ✅ 更新闹钟编辑对话框UI
- ✅ 添加编辑对话框滚动功能，支持鼠标滚轮滚动
- ✅ 创建默认声音获取指南和下载助手脚本
- ✅ 提供完整的声音资源管理文档

### v2.3 (2025-12-19)
- ✅ 优化每天循环闹钟，永不过期
- ✅ 创建/编辑闹钟时自动调整过期的循环闹钟到下一个有效时间
- ✅ 程序启动时自动修复过期的循环闹钟
- ✅ 改进用户提示信息，显示具体的调整时间
- ✅ 添加详细的功能说明文档

### v2.2 (2025-12-07)
- ✅ 升级到 .NET 8.0 LTS 框架
- ✅ 解决 NETSDK1138 警告问题
- ✅ 更新 System.Drawing.Common 到 8.0.0
- ✅ 整理项目文件结构（源代码移至 src/ 目录）
- ✅ 完善项目文档和升级指南
- ✅ 改进构建和调试配置

### v2.1 (2025-12-03)
- ✅ 新增强提醒功能（全屏遮罩）
- ✅ 新增弱提醒功能（任务栏通知）
- ✅ 每个闹钟可独立选择提醒方式
- ✅ 优化闹钟触发体验

### v2.0 (2025-12-03)
- ✅ 新增数据持久化功能
- ✅ 新增开机自动启动功能
- ✅ 新增查看数据文件功能
- ✅ 优化数据自动保存机制
- ✅ 改进用户界面布局

### v1.0
- ✅ 基础闹钟功能
- ✅ 多种循环模式
- ✅ 闹钟管理界面
- ✅ 实时时钟显示

## 🎨 图标设计

本项目拥有专业设计的应用图标：

- **设计风格**：现代扁平化设计
- **核心元素**：时钟表盘 + 双铃铛
- **配色方案**：蓝色渐变（专业）+ 金黄色（提醒）
- **文件格式**：SVG 矢量图（可无损缩放）

**查看详情**：[图标设计指南](docs/ICON_GUIDE.md)

**快速使用**：
1. 访问 https://convertio.co/zh/svg-ico/ 转换 `assets/icon.svg` 为 `icon.ico`
2. 修改 `AdvancedClock.csproj` 添加 `<ApplicationIcon>icon.ico</ApplicationIcon>`
3. 重新编译项目即可

## 最近更新

### 2025-12-19 新增自定义闹钟声音功能 🆕
- ✅ 支持为每个闹钟设置不同的提醒声音
- ✅ 支持 WAV, MP3, WMA, M4A 等多种音频格式
- ✅ 添加声音试听功能，预览声音效果
- ✅ 创建 AudioService 音频播放服务
- ✅ 详细说明文档：[自定义声音功能指南](docs/CUSTOM_SOUND_GUIDE.md)

### 2025-12-19 优化每天循环闹钟功能
- ✅ 每天循环的闹钟永不过期，自动更新到下一个有效时间
- ✅ 创建/编辑闹钟时，如果时间已过，自动调整到明天
- ✅ 程序启动时，自动修复过期的循环闹钟
- ✅ 触发后自动更新到下一天的相同时间
- ✅ 详细说明文档：[每天循环闹钟改进说明](docs/DAILY_ALARM_IMPROVEMENT.md)

### 2025-12-03 新增应用图标设计
- ✅ 创建专业的 SVG 矢量图标
- ✅ 现代扁平化设计风格
- ✅ 融合时钟和铃铛元素，高辨识度
- ✅ 提供完整的图标转换和使用指南
- ✅ 支持多尺寸 ICO 格式转换

### 2025-12-03 优化 GitHub Actions 配置 - 环境变量管理
- ✅ 将所有配置项提取到 `env` 环境变量中
- ✅ 移除硬编码，提高配置的可维护性和可重用性
- ✅ 添加详细的环境变量配置说明文档
- ✅ 支持快速适配其他项目

### 2025-12-03 修复 GitHub Actions 自动化构建配置
- ✅ 修复了 GitHub Actions 配置文件的错误
- ✅ 更新 .NET 版本从 8.0 到 7.0 匹配项目配置
- ✅ 简化构建流程，移除不必要的打包和签名步骤
- ✅ 使用实际的项目名称替换占位符
- ✅ 添加自动化构建产物上传功能
- ✅ 创建 GitHub Actions 使用指南文档

### 2025-12-03 修复强提醒窗口关闭按钮显示问题
- ✅ 修复了强提醒窗口关闭按钮被遮挡的问题
- ✅ 增加窗口卡片高度从 400 到 550
- ✅ 优化各元素的大小和间距，使布局更紧凑
- ✅ 确保所有内容（图标、标题、时钟、消息、按钮）完整可见

### 2025-12-03 新增强提醒和弱提醒功能
- ✅ 实现强提醒（全屏遮罩）功能
- ✅ 实现弱提醒（任务栏通知）功能
- ✅ 在编辑对话框中添加强提醒选项
- ✅ 强提醒窗口带有精美的UI设计和实时时钟显示
- ✅ 弱提醒使用Windows原生任务栏气泡通知

### 2025-12-03 修复编辑对话框布局问题
- ✅ 修复了编辑闹钟界面确认按钮看不到的问题
- ✅ 增加窗口高度从 450 到 550
- ✅ 允许窗口调整大小（最小高度 500，最小宽度 450）
- ✅ 优化说明信息区域的字体和间距
- ✅ 为按钮添加手型光标提升用户体验

### 2025-12-03 修复时间输入绑定问题
- ✅ 修复了 DateTime 只读属性双向绑定导致的异常
- ✅ 实现独立的时间输入验证逻辑
- ✅ 添加完整的输入验证（小时 0-23，分钟/秒 0-59）

## 📄 许可证

本项目仅供学习和个人使用。

## 🤝 贡献

欢迎提交问题和改进建议！

---

**享受使用高级定时闹钟！** ⏰
