# 每天循环闹钟功能测试指南

## 🧪 测试目的

验证每天循环闹钟的"永不过期"功能是否正常工作。

## 📋 测试前准备

### 环境要求
- Windows 操作系统
- .NET 8.0 SDK（或 .NET 7.0 SDK，需要修改项目配置）
- Visual Studio 2022 / Rider / VS Code

### 编译项目
```powershell
# 如果使用 .NET 8.0
dotnet build AdvancedClock.sln --configuration Debug

# 如果只有 .NET 7.0，需要先修改 AdvancedClock.csproj
# 将 <TargetFramework>net8.0-windows</TargetFramework>
# 改为 <TargetFramework>net7.0-windows</TargetFramework>
```

## 🧪 测试用例

### 测试1: 创建过期的每天循环闹钟

**目的**: 验证创建时自动调整功能

**步骤**:
1. 启动程序
2. 点击"添加闹钟"按钮
3. 填写以下信息：
   - 名称：`测试每天闹钟`
   - 日期：今天
   - 时间：一个已经过去的时间（例如：如果现在是20:00，设置为08:00）
   - 循环模式：选择"每天"
   - 消息：`测试消息`
4. 点击"确定"

**预期结果**:
- ✅ 显示消息框："设置的时间已经过去，已自动调整到下次每天的时间：[明天的日期] 08:00:00"
- ✅ 闹钟列表中显示的时间是明天的 08:00:00
- ✅ 闹钟状态为"启用"

**验证方法**:
```
查看闹钟列表中的"闹钟时间"列
应该显示：2025-12-20 08:00:00（明天的日期）
```

---

### 测试2: 编辑现有闹钟为过期时间

**目的**: 验证编辑时自动调整功能

**步骤**:
1. 在闹钟列表中选择一个现有的闹钟
2. 点击"编辑闹钟"按钮
3. 修改以下信息：
   - 循环模式：改为"每天"
   - 时间：改为一个已经过去的时间
4. 点击"确定"

**预期结果**:
- ✅ 显示消息框提示时间已自动调整
- ✅ 闹钟时间更新为明天的相同时间
- ✅ 数据自动保存

---

### 测试3: 程序重启后自动修复

**目的**: 验证启动时自动修复功能

**步骤**:
1. 创建一个每天 08:00 的闹钟
2. 等待闹钟触发（或手动修改数据文件中的时间为昨天）
3. 关闭程序
4. 重新启动程序
5. 查看调试输出（如果在 Visual Studio 中运行）

**预期结果**:
- ✅ 闹钟时间自动更新为今天或明天的 08:00
- ✅ 调试输出显示："自动修复闹钟 'xxx' 到下次每天时间: [日期时间]"
- ✅ 数据文件自动保存

**验证方法**:
```
1. 查看闹钟列表中的时间
2. 打开数据文件：%AppData%\AdvancedClock\alarms.json
3. 检查 AlarmTime 字段是否已更新
```

---

### 测试4: 闹钟触发后自动更新

**目的**: 验证触发后自动更新功能

**步骤**:
1. 创建一个每天循环的闹钟，时间设置为1分钟后
2. 等待闹钟触发
3. 关闭提醒窗口
4. 查看闹钟列表中的时间

**预期结果**:
- ✅ 闹钟触发并显示提醒
- ✅ 关闭提醒后，闹钟时间自动更新为明天的相同时间
- ✅ 闹钟保持启用状态
- ✅ 调试输出显示："循环闹钟已更新到下次时间: [日期时间]"

---

### 测试5: 长时间未运行的修复

**目的**: 验证长时间过期后的修复功能

**步骤**:
1. 创建一个每天 08:00 的闹钟
2. 关闭程序
3. 手动修改数据文件 `%AppData%\AdvancedClock\alarms.json`
   - 将 `AlarmTime` 改为3天前的日期
4. 保存文件
5. 重新启动程序

**预期结果**:
- ✅ 程序启动后自动检测到过期
- ✅ 闹钟时间更新为今天或明天的 08:00
- ✅ 调试输出显示修复信息

**手动修改示例**:
```json
{
  "Id": "...",
  "Name": "测试闹钟",
  "AlarmTime": "2025-12-16T08:00:00",  // 改为3天前
  "RepeatMode": "Daily",
  "IsEnabled": true,
  "Message": "测试消息"
}
```

---

### 测试6: 不同循环模式的测试

**目的**: 验证所有循环模式都支持自动调整

**步骤**:
分别测试以下循环模式：

#### 6.1 每月循环
1. 创建一个每月1号的闹钟，时间已过
2. 验证是否自动调整到下个月1号

#### 6.2 每年循环
1. 创建一个每年6月15日的闹钟，时间已过
2. 验证是否自动调整到明年6月15日

#### 6.3 不循环（对比测试）
1. 创建一个不循环的闹钟，时间已过
2. 验证是否显示警告提示（不自动调整）

**预期结果**:
- ✅ 每月循环：自动调整到下个月
- ✅ 每年循环：自动调整到明年
- ⚠️ 不循环：显示警告，不自动调整

---

## 🔍 调试技巧

### 查看调试输出
在 Visual Studio 或 Rider 中运行程序时，可以在"输出"窗口看到调试信息：

```
自动修复闹钟 '测试闹钟' 到下次每天时间: 2025-12-20 08:00:00
循环闹钟已更新到下次时间: 测试闹钟 -> 2025-12-20 08:00:00
```

### 查看数据文件
数据文件位置：`%AppData%\AdvancedClock\alarms.json`

快速打开方法：
1. 在程序中点击"📁 查看数据文件"按钮
2. 或者在文件资源管理器地址栏输入：`%AppData%\AdvancedClock`

### 手动修改数据文件
可以手动编辑 JSON 文件来模拟各种场景：
```json
{
  "Id": "guid",
  "Name": "测试闹钟",
  "AlarmTime": "2025-12-16T08:00:00",  // 修改这里
  "RepeatMode": "Daily",                // 或 Monthly, Yearly, None
  "IsEnabled": true,
  "Message": "测试消息",
  "IsStrongAlert": false
}
```

---

## ✅ 测试检查清单

完成以下所有测试项：

- [ ] 测试1: 创建过期的每天循环闹钟
- [ ] 测试2: 编辑现有闹钟为过期时间
- [ ] 测试3: 程序重启后自动修复
- [ ] 测试4: 闹钟触发后自动更新
- [ ] 测试5: 长时间未运行的修复
- [ ] 测试6.1: 每月循环模式
- [ ] 测试6.2: 每年循环模式
- [ ] 测试6.3: 不循环模式（对比）

---

## 🐛 常见问题

### Q1: 编译失败，提示不支持 .NET 8.0
**解决方法**:
1. 安装 .NET 8.0 SDK
2. 或者修改 `AdvancedClock.csproj`，将 `net8.0-windows` 改为 `net7.0-windows`

### Q2: 看不到调试输出
**解决方法**:
1. 确保在 Debug 模式下运行
2. 在 Visual Studio 中查看"输出"窗口
3. 在 Rider 中查看"Debug"窗口

### Q3: 数据文件没有自动保存
**解决方法**:
1. 检查 `%AppData%\AdvancedClock` 目录是否存在
2. 检查是否有写入权限
3. 查看调试输出是否有错误信息

---

## 📊 测试报告模板

```
测试日期：2025-12-19
测试人员：[你的名字]
测试环境：Windows 11, .NET 8.0

测试结果：
✅ 测试1: 通过
✅ 测试2: 通过
✅ 测试3: 通过
✅ 测试4: 通过
✅ 测试5: 通过
✅ 测试6.1: 通过
✅ 测试6.2: 通过
✅ 测试6.3: 通过

发现的问题：
[无] 或 [描述问题]

建议：
[你的建议]
```

---

**祝测试顺利！** 🎉
