# 闹钟自动化执行功能测试指南

## ✨ 新增功能概述

高级定时闹钟现已支持在闹钟触发时自动执行多种操作：
1. **打开网址** - 在默认浏览器中打开指定URL
2. **执行系统命令** - 运行CMD/PowerShell命令
3. **运行Python脚本** - 执行Python脚本文件

## 🚀 快速开始

### 1. 运行应用程序

```bash
cd F:\code\AdvancedClock
dotnet run
```

或者运行编译后的可执行文件：
```bash
.\bin\Release\net8.0-windows\AdvancedClock.exe
```

### 2. 测试场景

#### 场景 1: 打开网址

1. 点击"添加闹钟"按钮
2. 填写基本信息：
   - **名称**: 打开百度测试
   - **闹钟时间**: 设置为1分钟后
   - **循环模式**: 不循环
3. 在"触发时执行动作"区域：
   - 选择 **🌐 打开网址**
   - 输入URL: `https://www.baidu.com`
   - 点击"测试"按钮验证（可选）
4. 点击"确定"保存闹钟
5. 等待闹钟触发，浏览器将自动打开百度首页

#### 场景 2: 执行系统命令

1. 点击"添加闹钟"按钮
2. 填写基本信息：
   - **名称**: 打开记事本
   - **闹钟时间**: 设置为2分钟后
   - **循环模式**: 不循环
3. 在"触发时执行动作"区域：
   - 选择 **⚙️ 执行命令**
   - 输入命令: `notepad.exe`
   - 设置超时: 30秒
4. 点击"确定"保存
5. 等待闹钟触发，记事本将自动打开

**更多命令示例**：
- `calc` - 打开计算器
- `mspaint` - 打开画图工具
- `explorer C:\` - 打开C盘
- `echo Hello World` - 显示文本（输出会被记录到日志）

#### 场景 3: 运行Python脚本

**前提条件**: 系统已安装Python并添加到PATH环境变量

1. 点击"添加闹钟"按钮
2. 填写基本信息：
   - **名称**: Python脚本测试
   - **闹钟时间**: 设置为3分钟后
   - **循环模式**: 不循环
3. 在"触发时执行动作"区域：
   - 选择 **🐍 运行Python**
   - 点击"浏览"按钮，选择 `test_python_script.py` 文件
   - 设置超时: 30秒
4. 点击"确定"保存
5. 等待闹钟触发，Python脚本将自动执行

### 3. 查看执行日志

1. 点击主窗口底部的 **📋 查看日志** 按钮
2. 系统会打开日志文件目录：`%AppData%\AdvancedClock\logs\`
3. 日志文件命名格式：`alarm-log-yyyyMMdd.txt`
4. 查看最新的日志文件，可以看到：
   - 闹钟触发时间
   - 动作执行详情
   - 执行结果（成功/失败）
   - 错误信息（如有）
   - 执行耗时

## 📋 测试检查清单

### 基础功能测试
- [ ] 添加闹钟并配置动作
- [ ] 编辑已有闹钟的动作配置
- [ ] 测试按钮功能正常
- [ ] 闹钟触发时动作正确执行
- [ ] 闹钟触发后提醒正常显示

### 动作类型测试
- [ ] **仅提醒** - 不执行任何额外动作
- [ ] **打开网址** - HTTP/HTTPS链接正常打开
- [ ] **执行命令** - 系统命令正确执行
- [ ] **运行Python** - Python脚本正确执行

### 错误处理测试
- [ ] 输入无效URL - 显示验证错误
- [ ] 输入危险命令（如 `format`）- 被拦截
- [ ] Python脚本不存在 - 显示错误提示
- [ ] 命令执行超时 - 自动终止并记录
- [ ] 动作执行失败 - 日志记录错误详情

### 日志功能测试
- [ ] 日志文件自动创建
- [ ] 日志内容完整记录
- [ ] 日志按日期分割
- [ ] 查看日志按钮正常工作

## 🎯 示例配置

### 定时打开会议链接
```
名称: 每日站会
时间: 每天 09:00:00
循环: 每天
动作: 打开网址
参数: https://meet.google.com/your-meeting-link
提醒: 强提醒
```

### 定时系统备份
```
名称: 数据备份
时间: 每天 23:00:00
循环: 每天
动作: 执行命令
参数: robocopy C:\Data D:\Backup\Data /MIR /R:3 /W:10
超时: 300秒
```

### 定时运行数据处理脚本
```
名称: 数据分析任务
时间: 每天 02:00:00
循环: 每天
动作: 运行Python
参数: C:\Scripts\data_analysis.py
超时: 600秒
```

## ⚠️ 注意事项

1. **权限**: 某些系统命令可能需要管理员权限
2. **安全**: 谨慎使用系统命令，避免执行危险操作
3. **Python环境**: 确保Python已正确安装并配置
4. **超时设置**: 长时间运行的任务建议增加超时时间（5-300秒）
5. **日志查看**: 定期查看日志文件，监控执行状态

## 🔍 故障排查

### 问题: Python脚本无法执行
**解决方案**:
1. 检查Python是否已安装: `python --version`
2. 确认Python已添加到PATH环境变量
3. 尝试在命令行手动执行脚本: `python your_script.py`

### 问题: 命令执行超时
**解决方案**:
1. 增加超时时间设置（最大300秒）
2. 检查命令是否需要用户交互（避免使用需要交互的命令）
3. 查看日志了解具体超时原因

### 问题: 网址无法打开
**解决方案**:
1. 检查URL格式是否正确（必须包含 http:// 或 https://）
2. 确认默认浏览器已正确设置
3. 测试网络连接是否正常

## 📊 日志格式说明

日志文件中的每条记录包含：
```
2025-12-10 10:30:00.123 [INF] 闹钟触发 | 名称: 测试闹钟, 触发时间: 2025-12-10 10:30:00
2025-12-10 10:30:00.456 [INF] 开始执行动作 | 闹钟: 测试闹钟, 动作类型: 打开网址, 参数: https://www.baidu.com
2025-12-10 10:30:01.789 [INF] 动作执行成功 | 闹钟: 测试闹钟, 动作: 打开网址, 参数: https://www.baidu.com, 结果: 成功打开网址, 耗时: 0.85秒
```

## 🎉 功能亮点

1. **灵活配置** - 每个闹钟可独立配置不同的动作
2. **安全机制** - 危险命令自动拦截，参数验证
3. **超时控制** - 防止任务无限执行
4. **详细日志** - 完整记录执行历史，便于追溯
5. **测试功能** - 保存前可测试动作，确保配置正确
6. **错误提示** - 执行失败时友好的错误提示

---

**祝您使用愉快！** ⏰
如有问题，请查看日志文件获取详细信息。
